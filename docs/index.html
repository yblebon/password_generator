<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Password Generator</title>
<style>
  body {font-family:Arial,sans-serif;max-width:700px;margin:2rem auto;}
  .section{margin-bottom:1.5rem;}
  label{display:block;margin-bottom:.5rem;}
  input[type="number"]{width:60px;}
  #output{font-family:monospace;background:#f4f4f4;padding:.5rem;border:1px solid #ccc;}
  button{margin-right:.5rem;}
  .strength{font-weight:bold;}
  table{width:100%;border-collapse:collapse;margin-top:.5rem;}
  th,td{border:1px solid #ddd;padding:.5rem;text-align:left;}
  .delBtn{background:#e74c3c;color:#fff;border:none;padding:.3rem .6rem;cursor:pointer;}
</style>
</head>
<body>

<h2>Password Generator</h2>

<div class="section">
  <label><input type="radio" name="mode" value="words" checked> 3 Random Words</label>
  <label><input type="radio" name="mode" value="chars"> Pure Random Characters</label>
</div>

<div class="section" id="char-options" style="display:none;">
  <label>Length: <input type="number" id="charLength" min="6" value="12"></label>
</div>

<div class="section">
  <button id="generateBtn">Generate</button>
  <button id="copyBtn" disabled>Copy</button>
</div>

<div class="section">
  <div id="output"></div>
  <div>Strength: <span class="strength" id="strength"></span></div>
</div>

<hr>

<h3>Saved Passwords</h3>
<div class="section">
  <label>Tag: <input type="text" id="tagInput" placeholder="e.g., Email, Bank"></label>
  <button id="saveBtn" disabled>Save Locally</button>
</div>

<table id="savedTable">
  <thead>
    <tr><th>Date</th><th>Tag</th><th>Password</th><th>Action</th></tr>
  </thead>
  <tbody></tbody>
</table>

<script>
/* ---------- word list (larger sample) ---------- */
const WORDS = [
  "apple","river","mountain","sky","forest","cloud","stone","gold","silver",
  "shadow","light","storm","garden","planet","orbit","candle","bridge","river",
  "window","mirror","silence","whisper","ember","crystal","tide","breeze"
];

/* ---------- secure random helpers ---------- */
function getSecureRandomInt(max) {
  const array = new Uint32Array(1);
  crypto.getRandomValues(array);
  return array[0] % max;
}
function randomChoice(arr){return arr[getSecureRandomInt(arr.length)];}
function randomChar(){
  const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*()-_=+[]{}|;:,.<>?";
  return chars[getSecureRandomInt(chars.length)];
}

/* ---------- generation ---------- */
function generateWords(){return [randomChoice(WORDS),randomChoice(WORDS),randomChoice(WORDS)].join("-");}
function generateChars(len){let p="";for(let i=0;i<len;i++)p+=randomChar();return p;}

/* ---------- strength estimation (entropy based) ---------- */
function estimateStrength(pwd){
  let pool = 0;
  if(/[a-z]/.test(pwd)) pool += 26;
  if(/[A-Z]/.test(pwd)) pool += 26;
  if(/[0-9]/.test(pwd)) pool += 10;
  if(/[^A-Za-z0-9]/.test(pwd)) pool += 32; // approximate symbol set
  const bits = Math.log2(pool) * pwd.length;
  const label = bits < 40 ? "Very Weak"
            : bits < 60 ? "Weak"
            : bits < 80 ? "Moderate"
            : bits < 100 ? "Strong"
            : "Very Strong";
  return `${label} (${bits.toFixed(0)}â€¯bits)`;
}

/* ---------- UI handling ---------- */
const modeRadios = document.getElementsByName('mode');
const charOptions = document.getElementById('char-options');
const generateBtn = document.getElementById('generateBtn');
const copyBtn = document.getElementById('copyBtn');
const saveBtn = document.getElementById('saveBtn');
const outputDiv = document.getElementById('output');
const strengthSpan = document.getElementById('strength');
const tagInput = document.getElementById('tagInput');
const tbody = document.querySelector('#savedTable tbody');

function getMode(){return [...modeRadios].find(r=>r.checked).value;}
function updateUI(){charOptions.style.display = getMode()==='chars' ? 'block' : 'none';}
modeRadios.forEach(r=>r.addEventListener('change',updateUI));

generateBtn.addEventListener('click',()=>{
  const pwd = getMode()==='words' ? generateWords()
                                   : generateChars(parseInt(document.getElementById('charLength').value,10));
  outputDiv.textContent = pwd;
  strengthSpan.textContent = estimateStrength(pwd);
  copyBtn.disabled = false;
  saveBtn.disabled = false;
});

copyBtn.addEventListener('click',()=>{
  navigator.clipboard.writeText(outputDiv.textContent).then(()=>{
    copyBtn.textContent='Copied!';
    setTimeout(()=>copyBtn.textContent='Copy',1500);
  });
});

/* ---------- safe insertion & delete ---------- */
function escapeText(text){
  const div = document.createElement('div');
  div.textContent = text;
  return div.innerHTML;
}
function addRow(item){
  const tr = document.createElement('tr');

  const tdDate = document.createElement('td');
  tdDate.textContent = item.date;
  const tdTag = document.createElement('td');
  tdTag.textContent = item.tag;
  const tdPwd = document.createElement('td');
  tdPwd.textContent = item.pwd;
  const tdAct = document.createElement('td');
  const delBtn = document.createElement('button');
  delBtn.className = 'delBtn';
  delBtn.textContent = 'Delete';
  delBtn.addEventListener('click',()=>{removeEntry(item,tr);});
  tdAct.appendChild(delBtn);

  tr.append(tdDate, tdTag, tdPwd, tdAct);
  tbody.appendChild(tr);
}
function removeEntry(item,row){
  try{
    const saved = JSON.parse(localStorage.getItem('savedPasswords')||'[]');
    const filtered = saved.filter(i=> !(i.date===item.date && i.tag===item.tag && i.pwd===item.pwd));
    localStorage.setItem('savedPasswords',JSON.stringify(filtered));
  }catch(e){console.error(e);}
  row.remove();
}

/* ---------- save ---------- */
saveBtn.addEventListener('click',()=>{
  const pwd = outputDiv.textContent;
  const rawTag = tagInput.value.trim() || 'Untitled';
  const tag = rawTag; // stored as plain text; no HTML allowed
  const date = new Date().toLocaleString();
  const entry = {date, tag, pwd};

  addRow(entry);
  try{
    const saved = JSON.parse(localStorage.getItem('savedPasswords')||'[]');
    saved.push(entry);
    localStorage.setItem('savedPasswords',JSON.stringify(saved));
  }catch(e){console.error(e);}
  tagInput.value='';
  saveBtn.disabled=true;
});

/* ---------- load on start ---------- */
window.addEventListener('load',()=>{
  try{
    const saved = JSON.parse(localStorage.getItem('savedPasswords')||'[]');
    saved.forEach(addRow);
  }catch(e){console.error(e);}
});
</script>

</body>
</html>
